<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACIKY - Galería de Posturas de Yoga</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="icon" href="../images/black.png" type="image/x-icon">
</head>
<body>
    <!-- Header will be inserted by common.js -->
    <main id="galleryMain">
        <section class="blog-intro">
            <h2>Galería de Yoga</h2>
            <div class="gallery" id="galleryGrid">
                <!-- Gallery images will be loaded dynamically -->
            </div>
        </section>
    </main>
</body>
    <script src="../js/common.js"></script>
    <script>
        insertYogiQuote(` Existen ochenta y cuatro posturas de yoga. 
Sin embargo, todas las personas, ya sean 
occidentales u orientales, las han hecho 
en la matriz de la madre. Así que, ustedes 
son yoguis de todas maneras.`, "Yogi Bhajan");

        // API Base URL
        const API_BASE = window.location.hostname === 'camachoeng.github.io' 
            ? 'https://aciky-backend-298cb7d6b0a8.herokuapp.com/api'
            : 'http://127.0.0.1:3000/api';

        // Load gallery images
        async function loadGallery() {
            try {
                const response = await fetch(`${API_BASE}/gallery`);
                const result = await response.json();

                if (result.success && result.data) {
                    displayGallery(result.data);
                } else {
                    showEmptyState();
                }
            } catch (error) {
                console.error('Error loading gallery:', error);
                showEmptyState();
            }
        }

        function displayGallery(images) {
            const grid = document.getElementById('galleryGrid');
            
            if (images.length === 0) {
                showEmptyState();
                return;
            }

            // Group images by category
            const posturas = images.filter(img => img.category === 'posturas');
            const mudras = images.filter(img => img.category === 'mudras');

            let html = '';

            // Display Posturas Básicas section
            if (posturas.length > 0) {
                html += '<h2 class="gallery-section-title">Posturas Básicas</h2>';
                html += '<div class="gallery">';
                html += posturas.map(image => `
                    <figure class="gallery-thumb">
                        <img src="${image.thumbnail_url || image.image_url}" 
                             alt="${image.alt_text || image.title}" 
                             class="gallery-img" 
                             data-name="${escapeHtml(image.title)}" 
                             data-desc="${escapeHtml(image.description || '')}"
                             data-fullsrc="${image.image_url}">
                        <figcaption>${escapeHtml(image.title)}</figcaption>
                    </figure>
                `).join('');
                html += '</div>';
            }

            // Display Mudras Básicos section
            if (mudras.length > 0) {
                html += '<h2 class="gallery-section-title">Mudras Básicos</h2>';
                html += '<div class="gallery">';
                html += mudras.map(image => `
                    <figure class="gallery-thumb">
                        <img src="${image.thumbnail_url || image.image_url}" 
                             alt="${image.alt_text || image.title}" 
                             class="gallery-img" 
                             data-name="${escapeHtml(image.title)}" 
                             data-desc="${escapeHtml(image.description || '')}"
                             data-fullsrc="${image.image_url}">
                        <figcaption>${escapeHtml(image.title)}</figcaption>
                    </figure>
                `).join('');
                html += '</div>';
            }

            grid.innerHTML = html;

            // Add click handlers to gallery images
            attachImageClickHandlers();
        }

        function showEmptyState() {
            const grid = document.getElementById('galleryGrid');
            grid.innerHTML = `
                <div class="empty-state">
                    <p>No hay imágenes disponibles en la galería.</p>
                </div>
            `;
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function attachImageClickHandlers() {
            document.querySelectorAll('.gallery-img').forEach(function(img) {
                img.addEventListener('click', function() {
                    const src = img.getAttribute('data-fullsrc') || img.getAttribute('src');
                    const name = encodeURIComponent(img.getAttribute('data-name'));
                    const desc = encodeURIComponent(img.getAttribute('data-desc'));
                    window.open(`pose.html?src=${encodeURIComponent(src)}&name=${name}&desc=${desc}`, '_blank');
                });
            });
        }

        // Load gallery on page load
        document.addEventListener('DOMContentLoaded', loadGallery);
    </script>
</body>
</html>
